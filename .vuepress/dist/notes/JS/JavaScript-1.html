<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript原理 | 智宇星空</title>
    <meta name="description" content="前端学习资料">
    <link rel="icon" href="favicon.ico">
    
    <link rel="preload" href="/yjm.github.io/assets/css/0.styles.acbb5370.css" as="style"><link rel="preload" href="/yjm.github.io/assets/js/app.16d43aae.js" as="script"><link rel="preload" href="/yjm.github.io/assets/js/2.dc0e93a8.js" as="script"><link rel="preload" href="/yjm.github.io/assets/js/17.dc0284b9.js" as="script"><link rel="prefetch" href="/yjm.github.io/assets/js/10.beb399c5.js"><link rel="prefetch" href="/yjm.github.io/assets/js/11.ca77d212.js"><link rel="prefetch" href="/yjm.github.io/assets/js/12.45689107.js"><link rel="prefetch" href="/yjm.github.io/assets/js/13.aa1b3fbe.js"><link rel="prefetch" href="/yjm.github.io/assets/js/14.8a0e7fde.js"><link rel="prefetch" href="/yjm.github.io/assets/js/15.3633e7a9.js"><link rel="prefetch" href="/yjm.github.io/assets/js/16.b3294066.js"><link rel="prefetch" href="/yjm.github.io/assets/js/18.cbdb9d59.js"><link rel="prefetch" href="/yjm.github.io/assets/js/19.5251db80.js"><link rel="prefetch" href="/yjm.github.io/assets/js/20.12bad232.js"><link rel="prefetch" href="/yjm.github.io/assets/js/21.09047114.js"><link rel="prefetch" href="/yjm.github.io/assets/js/22.fb0bb1fc.js"><link rel="prefetch" href="/yjm.github.io/assets/js/23.befdb5d2.js"><link rel="prefetch" href="/yjm.github.io/assets/js/24.acbdd388.js"><link rel="prefetch" href="/yjm.github.io/assets/js/25.dd404484.js"><link rel="prefetch" href="/yjm.github.io/assets/js/26.bfe88547.js"><link rel="prefetch" href="/yjm.github.io/assets/js/27.b18b740d.js"><link rel="prefetch" href="/yjm.github.io/assets/js/28.4e88ab0e.js"><link rel="prefetch" href="/yjm.github.io/assets/js/29.e282f883.js"><link rel="prefetch" href="/yjm.github.io/assets/js/3.ba283e77.js"><link rel="prefetch" href="/yjm.github.io/assets/js/30.d6ff8809.js"><link rel="prefetch" href="/yjm.github.io/assets/js/31.2637266c.js"><link rel="prefetch" href="/yjm.github.io/assets/js/32.557aaf69.js"><link rel="prefetch" href="/yjm.github.io/assets/js/33.88f4e582.js"><link rel="prefetch" href="/yjm.github.io/assets/js/34.dae3780d.js"><link rel="prefetch" href="/yjm.github.io/assets/js/35.6b9506b5.js"><link rel="prefetch" href="/yjm.github.io/assets/js/36.858c4d62.js"><link rel="prefetch" href="/yjm.github.io/assets/js/37.f8d863af.js"><link rel="prefetch" href="/yjm.github.io/assets/js/38.a6cd0274.js"><link rel="prefetch" href="/yjm.github.io/assets/js/39.ddf074bc.js"><link rel="prefetch" href="/yjm.github.io/assets/js/4.5942c30c.js"><link rel="prefetch" href="/yjm.github.io/assets/js/40.04216fe1.js"><link rel="prefetch" href="/yjm.github.io/assets/js/41.8ef5b19c.js"><link rel="prefetch" href="/yjm.github.io/assets/js/42.99d6c4a5.js"><link rel="prefetch" href="/yjm.github.io/assets/js/43.6af8c75b.js"><link rel="prefetch" href="/yjm.github.io/assets/js/5.4c6ec876.js"><link rel="prefetch" href="/yjm.github.io/assets/js/6.82ba9ee8.js"><link rel="prefetch" href="/yjm.github.io/assets/js/7.d5846097.js"><link rel="prefetch" href="/yjm.github.io/assets/js/8.21d2d8cf.js"><link rel="prefetch" href="/yjm.github.io/assets/js/9.0c75ee61.js">
    <link rel="stylesheet" href="/yjm.github.io/assets/css/0.styles.acbb5370.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yjm.github.io/" class="home-link router-link-active"><!----> <span class="site-name">智宇星空</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/yjm.github.io/notes/VUE/" class="nav-link">前端笔记</a></div><div class="nav-item"><a href="/yjm.github.io/doc/" class="nav-link">资源导航</a></div><div class="nav-item"><a href="https://github.com/Jameel01" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/yjm.github.io/notes/VUE/" class="nav-link">前端笔记</a></div><div class="nav-item"><a href="/yjm.github.io/doc/" class="nav-link">资源导航</a></div><div class="nav-item"><a href="https://github.com/Jameel01" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/VUE/" class="sidebar-link">vue 开发笔记</a></li><li><a href="/yjm.github.io/notes/VUE/optimize.html" class="sidebar-link">性能优化</a></li><li><a href="/yjm.github.io/notes/VUE/vuecli.html" class="sidebar-link">Vue-CLI</a></li><li><a href="/yjm.github.io/notes/VUE/VUEX/" class="sidebar-link">vuex</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/REACT/" class="sidebar-link">React 开发笔记</a></li><li><a href="/yjm.github.io/notes/REACT/render.html" class="sidebar-link">React 渲染</a></li><li><a href="/yjm.github.io/notes/REACT/ReactApi.html" class="sidebar-link">React api</a></li><li><a href="/yjm.github.io/notes/REACT/Redux.html" class="sidebar-link">Redux</a></li><li><a href="/yjm.github.io/notes/REACT/Taro.html" class="sidebar-link">taro组件构子</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/JS/" class="sidebar-link">JS笔记</a></li><li><a href="/yjm.github.io/notes/JS/JavaScript-1.html" class="active sidebar-link">JavaScript原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yjm.github.io/notes/JS/JavaScript-1.html#块作用域" class="sidebar-link">块作用域</a></li><li class="sidebar-sub-header"><a href="/yjm.github.io/notes/JS/JavaScript-1.html#提升" class="sidebar-link">提升</a></li><li class="sidebar-sub-header"><a href="/yjm.github.io/notes/JS/JavaScript-1.html#闭包" class="sidebar-link">闭包</a></li><li class="sidebar-sub-header"><a href="/yjm.github.io/notes/JS/JavaScript-1.html#模块" class="sidebar-link">模块</a></li><li class="sidebar-sub-header"><a href="/yjm.github.io/notes/JS/JavaScript-1.html#this" class="sidebar-link">this</a></li><li class="sidebar-sub-header"><a href="/yjm.github.io/notes/JS/JavaScript-1.html#对象" class="sidebar-link">对象</a></li><li class="sidebar-sub-header"><a href="/yjm.github.io/notes/JS/JavaScript-1.html#委托" class="sidebar-link">委托</a></li></ul></li><li><a href="/yjm.github.io/notes/JS/es6.html" class="sidebar-link">ES6 语法</a></li><li><a href="/yjm.github.io/notes/JS/es5.html" class="sidebar-link">ES5</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>TypeScript 常用语法</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/typescript/type.html" class="sidebar-link">基础类型</a></li><li><a href="/yjm.github.io/notes/typescript/declare.html" class="sidebar-link">变量声明</a></li><li><a href="/yjm.github.io/notes/typescript/interface.html" class="sidebar-link">接口</a></li><li><a href="/yjm.github.io/notes/typescript/class.html" class="sidebar-link">类</a></li><li><a href="/yjm.github.io/notes/typescript/function.html" class="sidebar-link">函数</a></li><li><a href="/yjm.github.io/notes/typescript/generic.html" class="sidebar-link">泛型</a></li><li><a href="/yjm.github.io/notes/typescript/inference.html" class="sidebar-link">类型推断</a></li><li><a href="/yjm.github.io/notes/typescript/advance.html" class="sidebar-link">高级类型</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>DOM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/DOM/" class="sidebar-link">DOM</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/CSS/" class="sidebar-link">CSS开发笔记</a></li><li><a href="/yjm.github.io/notes/CSS/shapes/" class="sidebar-link">/notes/CSS/shapes/</a></li><li><a href="/yjm.github.io/notes/CSS/sass.html" class="sidebar-link">Dart-Sass</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/WEBPACK/" class="sidebar-link">webpack 性能优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>IOS问题库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/IOS/" class="sidebar-link">ios 问题库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/window/" class="sidebar-link">Event Loop</a></li><li><a href="/yjm.github.io/notes/window/HTTP/" class="sidebar-link">HTTP协议</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>RegExp</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/REGEXP/" class="sidebar-link">正则表达式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>git</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/GIT/" class="sidebar-link">git 三种工作流程</a></li><li><a href="/yjm.github.io/notes/GIT/gitflow.html" class="sidebar-link">git-flow 的工作流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yjm.github.io/notes/OTHER/" class="sidebar-link">其他</a></li><li><a href="/yjm.github.io/notes/OTHER/NPM.html" class="sidebar-link">verdaccio 私有npm仓库搭建</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript原理"><a href="#javascript原理" aria-hidden="true" class="header-anchor">#</a> JavaScript原理</h1> <h2 id="块作用域"><a href="#块作用域" aria-hidden="true" class="header-anchor">#</a> 块作用域</h2> <ol><li>函数不是唯一的作用域单元</li> <li>块作用域指的是变量和函数不仅可以属于所在的作用域，也可以属于某个代码块（通常指{...}内部）</li> <li>为变量显示声明作用域块，并对变量进行本地绑定是非常有用的工具</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 在这里做点有趣的事情</span>
<span class="token punctuation">}</span>
<span class="token comment">// 在这个块中定义的内容可以销毁了! </span>
<span class="token comment">// 作用域块声明</span>
<span class="token punctuation">{</span>
    <span class="token keyword">let</span> someReallyBigData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> 
    <span class="token function">process</span><span class="token punctuation">(</span> someReallyBigData <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token string">&quot;my_button&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">click</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;button clicked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>块作用域替代方案,catch 分句具有块作用域,并兼容es3</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
</code></pre></div><h2 id="提升"><a href="#提升" aria-hidden="true" class="header-anchor">#</a> 提升</h2> <p>正确思考思路：包括变量与函数在内的所有声明都会在代码被执行前首先被处理</p> <ol><li>只有声明本身被提升，而赋值或者其他运行逻辑会留在原初。</li> <li>包括变量和函数在内的所有声明都会在任何代码被执行前首先 被处理。</li> <li>当你看到 var a = 2; 时，可能会认为这是一个声明。但 JavaScript 实际上会将其看成两个 声明:var a;和a=2;。第一个定义声明是在编译阶段进行的。第二个赋值声明会被留在 原地等待执行阶段。</li> <li>每个作用域都会进行提示操作</li> <li>函数会首先被提升，然后才是变量</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span>

<span class="token keyword">var</span> foo<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span>
<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意，var foo 尽管出现在 function foo()... 的声明之前，但它是重复的声明(因此被忽 略了)，因为函数声明会被提升到普通变量之前</p> <ol start="6"><li>尽管重复的 var 声明会被忽略掉，但出现在后面的函数声明还是可以覆盖前面的</li> <li>一个普通块内部的函数声明通常会被提升到所在作用域的顶部，这个过程不会像下面的代 码暗示的那样可以被条件判断所控制</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//b</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>函数声明被提升，不受if控制，后声明的foo函数覆盖了前面的foo函数</p> <h2 id="闭包"><a href="#闭包" aria-hidden="true" class="header-anchor">#</a> 闭包</h2> <ol><li>无论使用何种方式对函数类型的值进行传递，当函数在别处被调用时都可以观察到闭包</li> <li>这个函数在定义时的词法作用域以外的地方被调用。闭包使得函数可以继续访问定义时的词法作用域</li> <li>在定时器、事件监听器、 Ajax 请求、跨窗口通信、Web Workers 或者任何其他的异步(或者同步)任务中，只要使 用了<code>回调函数</code>，实际上就是在使用闭包!</li> <li>动态作用域并不关心函数和作用域是如何声明以及在何处声明的，只关心它们从何处调用,但是JavaScript只有词法作用域，不具备动态作用域。</li> <li>闭包发生在定义时</li> <li>当函数可以记住并访问所在的词法作用域，即使函数是在当前词法作用域之外被执行，这时就产生了闭包</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> a <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> 
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>词法作用域让 foo() 中的 a 通过 RHS 引用到了全局作用域中的 a，因此会输出 2。</p> <h2 id="模块"><a href="#模块" aria-hidden="true" class="header-anchor">#</a> 模块</h2> <p>模块模式必须具备两个条件：</p> <ol><li>必须有外部封闭函数，该函数必须至少被调用一次（每次调用都会创建一个新的模块实例）</li> <li>封闭函数必须至少返回一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或修改私有变量</li></ol> <p>一个具有函数属性的对象本身并不是真正的模块，从方便观察的角度看，一个函数调用所返回的，只有数据属性而没有闭包函数的对象不是真正的模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">(</span>funtion <span class="token function">CoolModule</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 修改公共Api</span>
        publicAPI<span class="token punctuation">.</span>identify <span class="token operator">=</span> identify2
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">identify1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">identify2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> publicAPI <span class="token operator">=</span> <span class="token punctuation">{</span>
        change<span class="token punctuation">:</span>change<span class="token punctuation">,</span>
        identify<span class="token punctuation">:</span>identify1
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;foo module&quot;</span><span class="token punctuation">)</span>

foo<span class="token punctuation">.</span><span class="token function">identify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// foo module</span>
foo<span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span><span class="token function">identify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// FOO MODULE</span>
</code></pre></div><h2 id="this"><a href="#this" aria-hidden="true" class="header-anchor">#</a> this</h2> <h3 id="误解！"><a href="#误解！" aria-hidden="true" class="header-anchor">#</a> 误解！</h3> <ol><li>把this理解成指向函数本身</li> <li>this指向函数的作用域（this在任何情况下都不指向函数作用域）</li></ol> <p>注意：想要把this和词法作用域查找混合使用，这是无法实现的</p> <h3 id="this是什么"><a href="#this是什么" aria-hidden="true" class="header-anchor">#</a> this是什么</h3> <ol><li>this是运行时绑定的，不是在编译时绑定，它的上下文取决于函数调用时的各种情况。</li> <li>this的绑定和函数声明的位置没有任何关系，只取决于函数的调用方式</li> <li>this实际是函数被调用时发生的绑定，它指向什么完全取决函数在哪里被调用</li> <li>当函数被调用时，会创建一个活动记录（有时候也称上下文）。这个记录会包含函数在哪里被调用（调用栈）、函数的调用方法、传入的参数等信息。this就是记录的一个属性，会在函数的执行过程中用到。</li></ol> <h3 id="this绑定规则"><a href="#this绑定规则" aria-hidden="true" class="header-anchor">#</a> this绑定规则</h3> <h4 id="默认绑定"><a href="#默认绑定" aria-hidden="true" class="header-anchor">#</a> 默认绑定</h4> <p>独立函数调用，可以把这条规则看作是无法应用其他规则时的默认规则。</p> <p>默认绑定判定：</p> <ol><li>直接使用不带任何修饰的函数引用进行调用的，因此只能使用默认绑定，无法应用其他规则。</li> <li>如果使用严格模式(<code>strict mode</code>)，那么全局对象将无法使用默认绑定，因此 this 会绑定 到 <code>undefined</code>,非严格模式绑定到全局对象。</li></ol> <h4 id="隐式绑定"><a href="#隐式绑定" aria-hidden="true" class="header-anchor">#</a> 隐式绑定</h4> <ol><li>当函数引用有上下文对象时，隐式绑定规则会把函数调用中的this绑定到这个上下文对象</li> <li>对象属性引用链中只有对顶层或者说最后一层会影响调用位置</li></ol> <p>隐式丢失：</p> <ol><li>一个最常见的this绑定问题就是被隐式绑定的函数会丢失绑定对象，也就是说会应用默认绑定，从而把this绑定到全局对象上或者undefined，取决于是否严格模式</li> <li>一种更微妙、更常见并且更出乎意料的情况发生在传入回调函数时,<code>传参其实是一种隐式赋值</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">doFoo</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// fn 其实引用的是 foo </span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- 调用位置!</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> 
    a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    foo<span class="token punctuation">:</span> foo 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;oops, global&quot;</span><span class="token punctuation">;</span> <span class="token comment">// a 是全局对象的属性 </span>
<span class="token function">doFoo</span><span class="token punctuation">(</span> obj<span class="token punctuation">.</span>foo <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;oops, global&quot;</span>
</code></pre></div><ol start="3"><li>调用回调函数的函数可能会修改this</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span>
    foo<span class="token punctuation">:</span>foo
<span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;oops global&quot;</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>foo<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//oops global</span>
<span class="token comment">/****************************************/</span>
<span class="token comment">// javascript 内置函数伪代码</span>
<span class="token keyword">function</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span>delay</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 等待delay毫秒</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//&lt;-- 调用位置</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="显示绑定"><a href="#显示绑定" aria-hidden="true" class="header-anchor">#</a> 显示绑定</h4> <ol><li>call</li> <li>apply</li> <li>bind</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span>obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="new绑定"><a href="#new绑定" aria-hidden="true" class="header-anchor">#</a> new绑定</h4> <p>重新定义JavaScript中的“构造函数”：在JavaScript中，构造函数只是一些使用new操作符时被调用的函数。他并不会属于某个类，也不会实例化一个类。</p> <p>使用new来调用函数，或者说发生构造函数调用时，会自动执行下面操作</p> <ol><li>创建（构造）一个全新的对象</li> <li>这个新对象会被执行[[原型]]连接</li> <li><code>这个新对象会绑定到函数调用的this</code>（this绑定）</li> <li>如果函数没有返回其他对象，那么new表达式中的函数调用会自动返回这个新对象</li></ol> <h4 id="绑定优先级"><a href="#绑定优先级" aria-hidden="true" class="header-anchor">#</a> 绑定优先级</h4> <ol><li>由new调用？绑定到新创建的对象</li> <li>由call或apply或bind调用？绑定到指定对象</li> <li>由上下文调用?绑定到那个上下文对象</li> <li>默认：在严格模式绑定到undefined，否则绑定到全局对象</li></ol> <h2 id="对象"><a href="#对象" aria-hidden="true" class="header-anchor">#</a> 对象</h2> <h3 id="构造函数"><a href="#构造函数" aria-hidden="true" class="header-anchor">#</a> 构造函数</h3> <ol><li>new 会劫持所有普通函数并用构造对象的形式来调用它</li> <li>对象的 .constructor 会默认指向一个函数，这个函数可以通过对象的 .prototype 引用</li> <li>constructor并不表示构造</li> <li>a1.constructor 是一个非常不可靠并且不安全的引用。通常来说要尽量避免使用这些引用。</li></ol> <h3 id="（原型）继承"><a href="#（原型）继承" aria-hidden="true" class="header-anchor">#</a> （原型）继承</h3> <p>原型链：[[Prototype]] 机制就是存在于对象中的一个内部链接，它会引用其他
对象。通常来说，这个链接的作用是如果在对象上没有找到需要的属性或者方法引用，引擎就会继续在 [[Prototype]] 关联的对象上进行查找。同理，如果在后者中也没有找到需要的引用就会继续查找它的[[Prototype]]，以此类推。这一系列对象的链接被称之为“原型链”</p> <p>修改对象关联</p> <ol><li>Object.create()</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ES6 之前需要抛弃默认的 Bar.prototype</span>
<span class="token comment">// Object.create() 会创建一个新对象(Bar)并把它关联到制定对象(Foo)</span>
Bar<span class="token punctuation">.</span>ptototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Bar <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>Object.setPrototypeOf()</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ES6 开始可以直接修改现有的 Bar.prototype </span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span> <span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li><code>Object.create(null)</code> 会创建一个拥有空 [[Prototype]] 链接对象，这个对象无法进行委托。这些特殊的空 [[Prototype]] 对象通常被称之为“字典”，它完全不受原型链干扰，因此<code>非常适合用来储存数据</code></li> <li>关联两个对象最常用的方法是使用 new 关键词进行函数调用</li></ol> <p>检查关系</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>blah <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 方法1.instanceOf </span>
<span class="token comment">// 在a的整条[[Prototype]] 链中是否有指向Foo.prototype的对象</span>
<span class="token comment">// 这个方法只能处理对象(a)和函数(带 .prototype 引用的 Foo)之间的关系。</span>
<span class="token comment">// 如果你想判断两个对象(比如 a 和 b)之间是否通过 [[Prototype]] 链关联，只用 instanceof 无法实现</span>
a instanceOf Foo<span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// 方法2.isPrototypeOf</span>
<span class="token comment">// a 是否出现在Foo原型链中</span>
<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>注意：对象之间的关系不是复制而是委托</p> <h2 id="委托"><a href="#委托" aria-hidden="true" class="header-anchor">#</a> 委托</h2> <ol><li>行为委托认为对象之间是兄弟关系，互相委托，而不是父类和子类的关系。JavaScript 的 [[Prototype]] 机制本质上就是行为委托机制</li> <li>对象关联是一种编码风格，它提倡的是直接创建和关联对象，不把它抽象成类。对象关联可以用基于[[Prototype]]的行为委托非常自然的实现</li> <li>使用简洁方法时一定要小心这一点。如果你<code>需要自我引用</code>的话，那最好使用传统的<code>具名函数表达式</code>来定义对应的函数(baz: function baz(){..})，不要使用简洁方法</li> <li>对象关联可以更好地支持关注分离(separation of concerns)原则，创建和初始化并不需要 合并为一个步骤</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> LoginController <span class="token operator">=</span> <span class="token punctuation">{</span>
    error<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> AuthController <span class="token operator">=</span> <span class="token punctuation">{</span>
    error<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">checkAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">server</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 现在把 AuthController 关联到 LoginController</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>AuthController<span class="token punctuation">,</span>LoginController<span class="token punctuation">)</span>
</code></pre></div><p>行为委托与class模式对比</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// class</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height <span class="token operator">||</span> <span class="token number">50</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token operator">||</span> <span class="token number">50</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$elem <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">$where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$elem<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
                height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">'px'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span>$where<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> label</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>label <span class="token operator">=</span> label <span class="token operator">||</span> <span class="token string">'Default'</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$elem <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;button&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">$where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>$where<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$elem<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Button &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>label <span class="token operator">+</span> <span class="token string">&quot;clciked!&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> $body <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> btn1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> btn2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token string">'word'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    btn1<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>$body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    btn2<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>$body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 行为委托</span>
<span class="token keyword">var</span> Widget <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token operator">||</span> <span class="token number">50</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height <span class="token operator">||</span> <span class="token number">50</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$elem <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">insert</span><span class="token punctuation">(</span><span class="token parameter">$where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$elem<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
                width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">'px'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span>$where<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对象关联</span>
<span class="token keyword">var</span> Button <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Widget<span class="token punctuation">)</span><span class="token punctuation">;</span>

Button<span class="token punctuation">.</span><span class="token function-variable function">setup</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> label</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 委托调用</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>label <span class="token operator">=</span> label <span class="token operator">||</span> <span class="token string">'Default'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$elem <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;button&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Button<span class="token punctuation">.</span><span class="token function-variable function">build</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">$where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 委托调用</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>$where<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$elem<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Button<span class="token punctuation">.</span><span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Button '&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>label <span class="token operator">+</span> <span class="token string">&quot;' clicked!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> $body <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建btn1对象并把它关联到Button上</span>
    <span class="token keyword">var</span> btn1 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Button<span class="token punctuation">)</span><span class="token punctuation">;</span>
    btn1<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 创建btn2对象并把它关联到Button上</span>
    <span class="token keyword">var</span> btn2 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Button<span class="token punctuation">)</span><span class="token punctuation">;</span>
    btn2<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token string">'word'</span><span class="token punctuation">)</span>
    btn1<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>$body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    btn2<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>$body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">9/30/2019, 1:39:43 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yjm.github.io/notes/JS/" class="prev router-link-active">JS笔记</a></span> <span class="next"><a href="/yjm.github.io/notes/JS/es6.html">ES6 语法</a>→
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/yjm.github.io/assets/js/app.16d43aae.js" defer></script><script src="/yjm.github.io/assets/js/2.dc0e93a8.js" defer></script><script src="/yjm.github.io/assets/js/17.dc0284b9.js" defer></script>
  </body>
</html>
